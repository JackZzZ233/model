# Changes
* Add Unet training before reverse engineering, did not change the main steps of reverse engineering.
* Training steps: Unet---RONAN---Unet---RONAN
* See noise.py to check the dataset
* See inference_image0.py to check the noise added to the generated images
* Did not change unet_blocks and model







# Potential Problems
* The loss of Unet is higher than expected, possibly caused by the dataset(should be lower than the RONAN loss, but after 300 epochs, the loss was 10 times higher than RONAN's)
* Only used cifar-10 images as dataset, perhaps need to use other real images or belonging images
* The training was slow when using RTX 3070ti, 10 hours trained 300 epochs




# Environment
see requirements.txt

# Pre-trained Generative Models
For DCGAN, the pretrained model can be found in "dcgan_weights". Regarding the consistency model, pretrained models can be downloaded from https://github.com/openai/consistency_models; they are not directly uploaded in this repository due to their large file sizes. The remaining pretrained models will be downloaded automatically.

# Data 

* For CIFAR-10 and STL-10 dataset, you can download the corresponding .npz files in https://drive.google.com/drive/folders/1Q-Rbql0tc8rtp2QVTx8mq3_VZXsVDNx0.
* For ImageNet dataset, you can download it in https://www.image-net.org.
* Also, modify the line 30,42,44,65 of inference_image0.py to match the corresponding data directory.

# Reverse-engineering
To conduct reverse-engineering on the belonging imageswith noise:
```bash
python main.py --model_type dcgan_cifar10 --input_selection use_generated_image0 --distance_metric l2 --bs 1 --num_iter 1500 --strategy min --lr 0.1 --noise_type salt_and_pepper --noise_amount 0.05 --salt_vs_pepper 0.5 --noise_type_pic salt_pepper --salt_prob_pic 0.05
```

To conduct reverse-engineering on the non-belonging images (real images)with noise:
```bash
python main.py --model_type dcgan_cifar10 --input_selection use_cifar10_image0 --distance_metric l2 --bs 1 --num_iter 1500 --strategy min --lr 0.1 --noise_type salt_and_pepper --noise_amount 0.05 --salt_vs_pepper 0.5 --noise_type_pic salt_pepper --salt_prob_pic 0.05
```

To conduct reverse-engineering on the non-belonging images (images generated by other models) with noise:
```bash
python main.py --model_type styleganv2ada_cifar10 --input_selection_model_type dcgan_cifar10 --distance_metric l2 --bs 1 --num_iter 1500 --strategy min --lr 0.1 --noise_type salt_and_pepper --noise_amount 0.05 --salt_vs_pepper 0.5 --noise_type_pic salt_pepper --salt_prob_pic 0.05
```

## Cite this work
You are encouraged to cite the following paper if you use the repo for academic research.

```
@inproceedings{wang2023did,
  title={Where Did I Come From? Origin Attribution of AI-Generated Images},
  author={Wang, Zhenting and Chen, Chen and Zeng, Yi and Lyu, Lingjuan and Ma, Shiqing},
  booktitle={Thirty-seventh Conference on Neural Information Processing Systems},
  year={2023}
}
```

